<!DOCTYPE html>

<html class="light" lang="ko"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>계정 관리 - 초등학교 상담 웹사이트</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&amp;family=Noto+Sans+KR:wght@100..900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,0" rel="stylesheet"/>
<style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .material-symbols-outlined.fill {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
<script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#2bee8c",
              "background-light": "#f6f8f7",
              "background-dark": "#102219",
            },
            fontFamily: {
              "display": ["Lexend", "Noto Sans KR", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
          },
        },
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
</head>
<body class="font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden">
<div class="flex min-h-screen">
<!-- SideNavBar -->
<div class="flex flex-col border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900/50 w-64 p-4">
<div class="flex flex-col justify-between h-full">
<div class="flex flex-col gap-4">
<div class="flex items-center gap-3 px-2">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Admin profile picture" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAzovgAa0ymKP7NfrQtmNYKTyZBqddn0XXAj7rdhp0VKLSeUBgozd_sSn2OhhzdROYSHgVuKeVmI2OAPAdSpkI5pOttAHpPxFBlM-TyK-fZdxkWwqBEoRUbxGj1lkp7ZKIjh4rs5U_v43NO7nlLXOULZ7IaEFzpaqrJkdL631g3UYBUv0DeGBzmogsCjtcjcbJ8HgguLPSYS9sQsiz30YPnSIjRF9hAC48X3rPJDULlROePWumuLisczzEAh-JVY27myEhMG3nFYj95");'></div>
<div class="flex flex-col">
<h1 class="text-gray-900 dark:text-gray-100 text-base font-medium leading-normal">관리자</h1>
<p class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal">admin@school.com</p>
</div>
</div>
<div class="flex flex-col gap-2 mt-4">
<a class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" href="dashboard.html">
<span class="material-symbols-outlined">dashboard</span>
<p class="text-sm font-medium leading-normal">대시보드</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" href="record-list.html">
<span class="material-symbols-outlined">chat_bubble</span>
<p class="text-sm font-medium leading-normal">상담 관리</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/20 text-gray-900 dark:text-white dark:bg-primary/30" href="admin.html">
<span class="material-symbols-outlined fill">group</span>
<p class="text-sm font-medium leading-normal">계정 관리</p>
</a>
</div>
</div>
<div class="flex flex-col gap-1">
<button id="logout-btn" class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg w-full text-left">
<span class="material-symbols-outlined">logout</span>
<p class="text-sm font-medium leading-normal">로그아웃</p>
</button>
</div>
</div>
</div>
<!-- Main Content -->
<main class="flex-1 p-6 lg:p-10">
<div class="layout-content-container flex flex-col max-w-7xl mx-auto flex-1">
<!-- PageHeading -->
<div class="flex flex-wrap justify-between gap-3 p-4">
<div class="flex min-w-72 flex-col gap-3">
<p class="text-gray-900 dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">계정 관리</p>
<p class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal">학생 및 상담사 계정을 생성, 수정, 삭제합니다.</p>
</div>
</div>
<!-- Toolbar and Search/Filter section -->
<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-4">
<div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto">
<!-- SearchBar -->
<label class="flex flex-col min-w-40 h-12 w-full sm:w-72">
<div class="flex w-full flex-1 items-stretch rounded-xl h-full">
<div class="text-gray-500 dark:text-gray-400 flex border-none bg-white dark:bg-gray-800 items-center justify-center pl-4 rounded-l-xl border-r-0">
<span class="material-symbols-outlined">search</span>
</div>
<input class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-gray-900 dark:text-gray-100 focus:outline-0 focus:ring-2 focus:ring-primary/50 border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 h-full placeholder:text-gray-500 dark:placeholder:text-gray-400 px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" placeholder="이름 또는 이메일로 검색" value=""/>
</div>
</label>
<!-- Chips / Filters -->
<div class="flex gap-2 p-1 overflow-x-auto">
<button id="filter-all" class="filter-chip flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-primary/20 dark:bg-primary/30 px-4">
<p class="text-gray-800 dark:text-gray-200 text-sm font-medium leading-normal">전체</p>
</button>
<button id="filter-student" class="filter-chip flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 px-4">
<p class="text-gray-700 dark:text-gray-300 text-sm font-medium leading-normal">학생</p>
</button>
<button id="filter-counselor" class="filter-chip flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 px-4">
<p class="text-gray-700 dark:text-gray-300 text-sm font-medium leading-normal">상담사</p>
</button>
</div>
</div>
<!-- Add new user button -->
<button id="add-user-btn" class="flex w-full sm:w-auto max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 bg-primary text-gray-900 gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-5">
<span class="material-symbols-outlined fill">add</span>
<span class="truncate">신규 계정 생성</span>
</button>
</div>
<!-- User List Table -->
<div class="mt-4 p-4">
<div class="overflow-x-auto bg-white dark:bg-gray-900/50 rounded-xl border border-gray-200 dark:border-gray-700">
<table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
<thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800">
<tr>
<th class="p-4" scope="col">
<div class="flex items-center">
<input class="w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" id="checkbox-all" type="checkbox"/>
<label class="sr-only" for="checkbox-all">checkbox</label>
</div>
</th>
<th class="px-6 py-3" scope="col">이름</th>
<th class="px-6 py-3" scope="col">역할</th>
<th class="px-6 py-3" scope="col">이메일</th>
<th class="px-6 py-3" scope="col">상태</th>
<th class="px-6 py-3" scope="col">관리</th>
</tr>
</thead>
<tbody>
<tr class="bg-white dark:bg-gray-900/50 hover:bg-gray-50 dark:hover:bg-gray-800/50 border-b dark:border-gray-700">
<td class="w-4 p-4"><input class="w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" type="checkbox"/></td>
<td class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap">김민준</td>
<td class="px-6 py-4"><span class="bg-blue-100 text-blue-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300">학생</span></td>
<td class="px-6 py-4">minjun.kim@example.com</td>
<td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">활성</span></td>
<td class="px-6 py-4 flex items-center gap-2">
<button class="p-2 text-gray-500 hover:text-gray-900 dark:hover:text-white"><span class="material-symbols-outlined text-base">edit</span></button>
<button class="p-2 text-gray-500 hover:text-red-600 dark:hover:text-red-500"><span class="material-symbols-outlined text-base">delete</span></button>
</td>
</tr>
<tr class="bg-white dark:bg-gray-900/50 hover:bg-gray-50 dark:hover:bg-gray-800/50 border-b dark:border-gray-700">
<td class="w-4 p-4"><input class="w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" type="checkbox"/></td>
<td class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap">박서연</td>
<td class="px-6 py-4"><span class="bg-indigo-100 text-indigo-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-indigo-900 dark:text-indigo-300">상담사</span></td>
<td class="px-6 py-4">seoyeon.park@example.com</td>
<td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">활성</span></td>
<td class="px-6 py-4 flex items-center gap-2">
<button class="p-2 text-gray-500 hover:text-gray-900 dark:hover:text-white"><span class="material-symbols-outlined text-base">edit</span></button>
<button class="p-2 text-gray-500 hover:text-red-600 dark:hover:text-red-500"><span class="material-symbols-outlined text-base">delete</span></button>
</td>
</tr>
<tr class="bg-white dark:bg-gray-900/50 hover:bg-gray-50 dark:hover:bg-gray-800/50 border-b dark:border-gray-700">
<td class="w-4 p-4"><input class="w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" type="checkbox"/></td>
<td class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap">이하은</td>
<td class="px-6 py-4"><span class="bg-blue-100 text-blue-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300">학생</span></td>
<td class="px-6 py-4">haeun.lee@example.com</td>
<td class="px-6 py-4"><span class="bg-red-100 text-red-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300">비활성</span></td>
<td class="px-6 py-4 flex items-center gap-2">
<button class="p-2 text-gray-500 hover:text-gray-900 dark:hover:text-white"><span class="material-symbols-outlined text-base">edit</span></button>
<button class="p-2 text-gray-500 hover:text-red-600 dark:hover:text-red-500"><span class="material-symbols-outlined text-base">delete</span></button>
</td>
</tr>
<tr class="bg-white dark:bg-gray-900/50 hover:bg-gray-50 dark:hover:bg-gray-800/50">
<td class="w-4 p-4"><input class="w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" type="checkbox"/></td>
<td class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap">최지우</td>
<td class="px-6 py-4"><span class="bg-indigo-100 text-indigo-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-indigo-900 dark:text-indigo-300">상담사</span></td>
<td class="px-6 py-4">jiwoo.choi@example.com</td>
<td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">활성</span></td>
<td class="px-6 py-4 flex items-center gap-2">
<button class="p-2 text-gray-500 hover:text-gray-900 dark:hover:text-white"><span class="material-symbols-outlined text-base">edit</span></button>
<button class="p-2 text-gray-500 hover:text-red-600 dark:hover:text-red-500"><span class="material-symbols-outlined text-base">delete</span></button>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</main>
</div>
</div>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    // Wait for Supabase to be initialized
    const waitForSupabase = () => {
        return new Promise((resolve, reject) => {
            let attempts = 0;
            const maxAttempts = 50;
            const checkSupabase = () => {
                attempts++;
                if (supabase) {
                    resolve(supabase);
                } else if (attempts >= maxAttempts) {
                    reject(new Error('Supabase initialization timeout'));
                } else {
                    setTimeout(checkSupabase, 100);
                }
            };
            checkSupabase();
        });
    };

    let client;
    try {
        client = await waitForSupabase();
    } catch (error) {
        console.error('Failed to initialize Supabase:', error);
        alert('초기화 중 오류가 발생했습니다. 페이지를 새로고침해주세요.');
        return;
    }

    // Auth Guard
    const { data: { session } } = await client.auth.getSession();
    if (!session) {
        window.location.href = 'index.html';
        return;
    }

    // Update user info display
    const user = session.user;
    const userEmailEl = document.querySelector('p.text-gray-500');
    if (userEmailEl && user?.email) {
        userEmailEl.textContent = user.email;
    }

    // Logout Handler
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', async () => {
            await signOut();
            window.location.href = 'index.html';
        });
    }

    // Navigation links
    const dashboardLink = document.querySelector('a[href*="dashboard"]');
    if (dashboardLink) {
        dashboardLink.href = 'dashboard.html';
    }

    // Add new user button
    const addUserBtn = document.getElementById('add-user-btn');
    if (addUserBtn) {
        addUserBtn.addEventListener('click', () => {
            const email = prompt('새 사용자의 이메일을 입력하세요:');
            if (!email) return;
            
            const password = prompt('비밀번호를 입력하세요 (최소 6자):');
            if (!password || password.length < 6) {
                alert('비밀번호는 최소 6자 이상이어야 합니다.');
                return;
            }

            const role = confirm('상담사 계정으로 생성하시겠습니까?\n(취소하면 학생 계정으로 생성됩니다)') ? 'counselor' : 'student';

            // Note: Supabase Admin API를 사용하려면 서버 사이드 코드가 필요합니다.
            // 클라이언트에서는 signUp을 사용할 수 있지만, 이메일 인증이 필요합니다.
            alert('계정 생성 기능은 서버 사이드에서 구현해야 합니다.\n현재는 Supabase 대시보드에서 직접 사용자를 생성해주세요.\n\n또는 다음 기능을 구현하려면:\n1. Supabase Edge Function 생성\n2. Admin API 키 사용\n3. 서버에서 사용자 생성 API 구현');
        });
    }

    // Edit and Delete buttons
    const tableRows = document.querySelectorAll('tbody tr');
    tableRows.forEach(row => {
        const editBtn = row.querySelector('button:has(.material-symbols-outlined)');
        const deleteBtn = row.querySelectorAll('button:has(.material-symbols-outlined)')[1];
        
        if (editBtn && editBtn.querySelector('.material-symbols-outlined').textContent.includes('edit')) {
            editBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const name = row.querySelector('td:nth-child(2)')?.textContent.trim();
                if (name) {
                    alert(`${name}의 정보를 수정하는 기능은 아직 구현되지 않았습니다.\nSupabase 대시보드에서 사용자 정보를 직접 수정해주세요.`);
                }
            });
        }
        
        if (deleteBtn && deleteBtn.querySelector('.material-symbols-outlined').textContent.includes('delete')) {
            deleteBtn.addEventListener('click', async (e) => {
                e.stopPropagation();
                const name = row.querySelector('td:nth-child(2)')?.textContent.trim();
                const email = row.querySelector('td:nth-child(4)')?.textContent.trim();
                
                if (name && confirm(`정말 ${name}(${email}) 계정을 삭제하시겠습니까?`)) {
                    // Note: Supabase Admin API를 사용하려면 서버 사이드 코드가 필요합니다.
                    alert('계정 삭제 기능은 서버 사이드에서 구현해야 합니다.\n현재는 Supabase 대시보드에서 직접 사용자를 삭제해주세요.');
                }
            });
        }
    });

    // Search functionality
    const searchInput = document.querySelector('input[placeholder*="이름 또는 이메일"]');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }, 300);
        });
    }

    // Filter buttons
    const filterAllBtn = document.getElementById('filter-all');
    const filterStudentBtn = document.getElementById('filter-student');
    const filterCounselorBtn = document.getElementById('filter-counselor');
    const filterChips = [filterAllBtn, filterStudentBtn, filterCounselorBtn];

    function applyFilter(filterType) {
        // Update button styles
        filterChips.forEach(btn => {
            if (btn) {
                btn.classList.remove('bg-primary/20', 'dark:bg-primary/30');
                btn.classList.add('bg-gray-100', 'dark:bg-gray-800');
            }
        });
        
        if (filterType === 'all' && filterAllBtn) {
            filterAllBtn.classList.remove('bg-gray-100', 'dark:bg-gray-800');
            filterAllBtn.classList.add('bg-primary/20', 'dark:bg-primary/30');
        } else if (filterType === 'student' && filterStudentBtn) {
            filterStudentBtn.classList.remove('bg-gray-100', 'dark:bg-gray-800');
            filterStudentBtn.classList.add('bg-primary/20', 'dark:bg-primary/30');
        } else if (filterType === 'counselor' && filterCounselorBtn) {
            filterCounselorBtn.classList.remove('bg-gray-100', 'dark:bg-gray-800');
            filterCounselorBtn.classList.add('bg-primary/20', 'dark:bg-primary/30');
        }

        // Filter table rows
        const rows = document.querySelectorAll('tbody tr');
        rows.forEach(row => {
            if (filterType === 'all') {
                row.style.display = '';
            } else {
                const role = row.querySelector('td:nth-child(3) span')?.textContent.trim();
                const shouldShow = 
                    (filterType === 'student' && role === '학생') ||
                    (filterType === 'counselor' && role === '상담사');
                row.style.display = shouldShow ? '' : 'none';
            }
        });
    }

    if (filterAllBtn) {
        filterAllBtn.addEventListener('click', () => applyFilter('all'));
    }
    if (filterStudentBtn) {
        filterStudentBtn.addEventListener('click', () => applyFilter('student'));
    }
    if (filterCounselorBtn) {
        filterCounselorBtn.addEventListener('click', () => applyFilter('counselor'));
    }
});
</script>
</body></html>